AWSTemplateFormatVersion: 2010-09-09

Parameters:
  OAuthToken:
    Type: String
    Description: Token to access github

Resources:
  SnSCreateDeletePipeline:
    Type: AWS::Lambda::Function
    Properties:
      Handler: lambda/createDeletePipeline.handler
      Runtime: nodejs4.3
      Role: "arn:aws:iam::644500628210:role/codepipelinebuildlambda"
      Code:
        S3Bucket: "social-event-pipeline-build"
        S3Key: "updater/CODEBUILD_BUILD_ID/pipelineLambda.zip"
      Environment:
        Variables:
          O_AUTH_TOKEN: !Ref "OAuthToken"
  LogPipeline:
    Type: AWS::Lambda::Function
    Properties:
      Handler: lambda/logPipeline.handler
      Runtime: nodejs4.3
      Role: "arn:aws:iam::644500628210:role/codepipelinebuildlambda"
      Code:
        S3Bucket: "social-event-pipeline-build"
        S3Key: "updater/CODEBUILD_BUILD_ID/pipelineLambda.zip"
  SNSPipelineSubscriber:
    Type: AWS::SNS::Subscription
    Properties:
      Endpoint: !Ref "SnSCreateDeletePipeline"
      Protocol: "lambda"
      TopicArn: "arn:aws:sns:eu-central-1:644500628210:social-event-github-trigger"